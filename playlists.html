<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Playlists | Zedtopvibes</title>
<link rel="stylesheet" href="/css/shared/main.css">
</head>
<body>
    <div class="main-content-container" id="content">
        <div style="text-align: center; padding: 60px; width: 100%;">Loading playlists...</div>
    </div>

    <script type="module">
        import { API_BASE, formatNumber } from '/js/shared/helpers.js';
        import { goToPlaylistBySlug } from '/js/shared/navigation.js';
        import { fetchPlaylists } from '/js/shared/api.js';
        import { injectTemplates, loadTemplate } from '/js/shared/template-loader.js';

        // Load playlists
        async function loadPlaylists() {
            try {
                const skeleton = await loadTemplate('loading-skeleton');
                document.getElementById('content').innerHTML = skeleton;

                const playlists = await fetchPlaylists();
                renderPlaylists(playlists);

            } catch (error) {
                console.error('Error loading playlists:', error);
            }
        }

        function renderPlaylists(playlists) {
            const content = document.getElementById('content');
            
            content.innerHTML = `
                <aside class="left-sidebar">
                    <div class="breadcrumbs">
                        <a href="/">Home</a> / <span>Playlists</span>
                    </div>
                    
                    <div class="section-header">
                        <h2 class="section-title">All Playlists</h2>
                        <a href="#" class="view-all">View All âž”</a>
                    </div>
                    
                    <div class="playlist-list">
                        ${playlists.map(playlist => `
                            <div class="playlist-item" onclick="goToPlaylistBySlug('${playlist.slug}')">
                                <div class="playlist-thumb">${playlist.cover_emoji || 'ðŸ“‹'}</div>
                                <div class="playlist-info">
                                    <div class="playlist-title">${playlist.name}</div>
                                    <div class="playlist-meta">
                                        <span class="playlist-badge">${playlist.track_count || 0} tracks</span>
                                        <span class="playlist-stats"><i class="fas fa-eye"></i> ${formatNumber(playlist.views)}</span>
                                        ${playlist.is_featured ? '<span class="playlist-badge">Featured</span>' : ''}
                                    </div>
                                    <div class="playlist-description">${playlist.description || ''}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </aside>
                
                <div class="right-sidebar">
                    <section class="section-block">
                        <div class="section-header">
                            <h2 class="section-title">Featured Playlists</h2>
                            <a href="#" class="view-all">View All âž”</a>
                        </div>
                        <div>
                            ${playlists.filter(p => p.is_featured).slice(0, 3).map(playlist => `
                                <div class="sidebar-item" onclick="goToPlaylistBySlug('${playlist.slug}')">
                                    <div class="sidebar-thumb">${playlist.cover_emoji || 'ðŸ“‹'}</div>
                                    <div class="sidebar-info">
                                        <div class="sidebar-title">${playlist.name}</div>
                                        <div class="sidebar-sub">${playlist.track_count || 0} tracks</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                </div>
            `;
        }

        // Initialize page
        async function initPage() {
            await injectTemplates();
            const footerHtml = await loadTemplate('footer');
            document.body.insertAdjacentHTML('beforeend', footerHtml);
            await loadPlaylists();
        }

        initPage();
        
        window.goToPlaylistBySlug = goToPlaylistBySlug;
    </script>
</body>
</html>