<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zedtopvibes â€¢ Albums</title>
    <!-- Shared CSS -->
    <link rel="stylesheet" href="/css/shared/main.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Simple header fallback -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="hamburger" onclick="window.location.href='/'">â˜°</div>
            <div class="site-title"><a href="/">ZEDTOPVIBES</a></div>
            <div class="right-spacer"></div>
        </div>
    </nav>

    <!-- MAIN CONTENT CONTAINER -->
    <div class="main-content-container" id="content">
        <div style="text-align: center; padding: 60px;">Loading albums...</div>
    </div>

    <!-- Simple footer fallback -->
    <footer class="footer">
        <div class="footer-links">
            <a href="/">Home</a>
            <a href="/albums.html">Albums</a>
            <a href="/playlists.html">Playlists</a>
        </div>
        <div class="copyright">Â© 2024 Zedtopvibes</div>
    </footer>

    <script type="module">
        // Import only if available, with fallback
        let formatNumber = (num) => num;
        let goToAlbumBySlug = (slug) => { window.location.href = `/album/${slug}`; };
        let goToArtist = (name) => { window.location.href = `/artist/${name}`; };
        
        try {
            const helpers = await import('/js/shared/helpers.js');
            formatNumber = helpers.formatNumber;
        } catch (e) {
            console.log('Using fallback formatters');
        }

        // API Base
        const API_BASE = '/api';

        // Load albums
        async function loadAlbums() {
            try {
                const response = await fetch(`${API_BASE}/albums`);
                const albums = await response.json();
                
                const content = document.getElementById('content');
                
                content.innerHTML = `
                    <aside class="left-sidebar">
                        <div class="breadcrumbs">
                            <a href="/">Home</a> / <span>Albums</span>
                        </div>
                        
                        <div class="section-header">
                            <h2 class="section-title">All Albums</h2>
                            <a href="#" class="view-all">View All âž”</a>
                        </div>
                        
                        <div class="album-list">
                            ${albums.map(album => `
                                <div class="album-item" onclick="window.location.href='/album/${album.slug}'">
                                    <div class="album-thumb">${album.cover_emoji || 'ðŸ’¿'}</div>
                                    <div class="album-info">
                                        <div class="album-title">${album.title}</div>
                                        <div class="album-meta">
                                            <span class="album-artist" onclick="event.stopPropagation(); window.location.href='/artist/${album.artist_slug}'">${album.artist}</span>
                                            <span class="album-tracks">${album.track_count || 0} tracks</span>
                                            <span class="album-stats"><i class="fas fa-eye"></i> ${formatNumber(album.views)}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </aside>
                    
                    <div class="right-sidebar">
                        <section class="section-block">
                            <div class="section-header">
                                <h2 class="section-title">Featured Albums</h2>
                                <a href="#" class="view-all">View All âž”</a>
                            </div>
                            <div>
                                ${albums.filter(a => a.is_featured).slice(0, 3).map(album => `
                                    <div class="sidebar-item" onclick="window.location.href='/album/${album.slug}'">
                                        <div class="sidebar-thumb">${album.cover_emoji || 'ðŸ’¿'}</div>
                                        <div class="sidebar-info">
                                            <div class="sidebar-title">${album.title}</div>
                                            <div class="sidebar-sub">${album.artist}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </section>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('content').innerHTML = `<div style="padding: 60px; text-align: center;">Error: ${error.message}</div>`;
            }
        }

        loadAlbums();
    </script>
</body>
</html>