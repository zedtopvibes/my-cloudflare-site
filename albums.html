<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Albums | Zedtopvibes</title>
</head>
<body>
    <div class="main-content-container" id="content">
        <div style="text-align: center; padding: 60px; width: 100%;">Loading albums...</div>
    </div>

    <script type="module">
        import { API_BASE, formatNumber, getRandomColor } from '/js/shared/helpers.js';
        import { goToArtist, goToAlbumBySlug } from '/js/shared/navigation.js';
        import { fetchAlbums } from '/js/shared/api.js';
        import { injectTemplates, loadTemplate } from '/js/shared/template-loader.js';

        // Load albums
        async function loadAlbums() {
            try {
                const skeleton = await loadTemplate('loading-skeleton');
                document.getElementById('content').innerHTML = skeleton;

                const albums = await fetchAlbums();
                renderAlbums(albums);

            } catch (error) {
                console.error('Error loading albums:', error);
            }
        }

        function renderAlbums(albums) {
            const content = document.getElementById('content');
            
            content.innerHTML = `
                <aside class="left-sidebar">
                    <div class="breadcrumbs">
                        <a href="/">Home</a> / <span>Albums</span>
                    </div>
                    
                    <div class="section-header">
                        <h2 class="section-title">All Albums</h2>
                        <a href="#" class="view-all">View All âž”</a>
                    </div>
                    
                    <div class="album-list">
                        ${albums.map(album => `
                            <div class="album-item" onclick="goToAlbumBySlug('${album.slug}')">
                                <div class="album-thumb">${album.cover_emoji || 'ðŸ’¿'}</div>
                                <div class="album-info">
                                    <div class="album-title">${album.title}</div>
                                    <div class="album-meta">
                                        <span class="album-artist" onclick="event.stopPropagation(); goToArtist('${album.artist.replace(/'/g, "\\'")}')">${album.artist}</span>
                                        <span class="album-tracks">${album.track_count || 0} tracks</span>
                                        <span class="album-stats"><i class="fas fa-eye"></i> ${formatNumber(album.views)}</span>
                                    </div>
                                    <div class="album-year">ðŸ“… ${album.release_date ? new Date(album.release_date).getFullYear() : 'Unknown'}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </aside>
                
                <div class="right-sidebar">
                    <section class="section-block">
                        <div class="section-header">
                            <h2 class="section-title">Featured Albums</h2>
                            <a href="#" class="view-all">View All âž”</a>
                        </div>
                        <div>
                            ${albums.filter(a => a.is_featured).slice(0, 3).map(album => `
                                <div class="sidebar-item" onclick="goToAlbumBySlug('${album.slug}')">
                                    <div class="sidebar-thumb">${album.cover_emoji || 'ðŸ’¿'}</div>
                                    <div class="sidebar-info">
                                        <div class="sidebar-title">${album.title}</div>
                                        <div class="sidebar-sub">${album.artist}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                    
                    <section class="section-block">
                        <div class="section-header">
                            <h2 class="section-title">Top Artists</h2>
                            <a href="#" class="view-all">View All âž”</a>
                        </div>
                        <div>
                            ${[...new Set(albums.map(a => a.artist))].slice(0, 3).map(artist => `
                                <div class="sidebar-item" onclick="goToArtist('${artist.replace(/'/g, "\\'")}')">
                                    <div class="sidebar-thumb">ðŸ‘¤</div>
                                    <div class="sidebar-info">
                                        <div class="sidebar-title">${artist}</div>
                                        <div class="sidebar-sub">Artist</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                </div>
            `;
        }

        // Initialize page
        async function initPage() {
            await injectTemplates();
            const footerHtml = await loadTemplate('footer');
            document.body.insertAdjacentHTML('beforeend', footerHtml);
            await loadAlbums();
        }

        initPage();
        
        window.goToArtist = goToArtist;
        window.goToAlbumBySlug = goToAlbumBySlug;
    </script>
</body>
</html>