<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zedtopvibes â€¢ Artist</title>
    <!-- Shared CSS -->
    <link rel="stylesheet" href="/css/shared/main.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Additional artist-specific styles */
        .artist-header {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(255,85,0,0.05) 0%, rgba(255,140,0,0.05) 100%);
            border-bottom: 1px solid #e8e8e8;
        }

        .artist-cover-large {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff5500, #ff8c00);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            color: white;
            box-shadow: 0 4px 15px rgba(255,85,0,0.3);
            flex-shrink: 0;
        }

        .artist-info-large {
            flex: 1;
        }

        .artist-title-large {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            color: #222;
        }

        .artist-genre-large {
            color: #ff5500;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .artist-meta-large {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .artist-stat-large {
            background: rgba(255,85,0,0.08);
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #555;
        }

        .artist-stat-large i {
            color: #ff5500;
        }

        .artist-stat-large strong {
            color: #ff5500;
            font-weight: 700;
            margin-left: 3px;
        }

        /* Track items with smaller stats */
        .track-stats-small {
            display: flex;
            gap: 15px;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #888;
        }

        .track-stats-small i {
            color: #ff5500;
            margin-right: 3px;
        }

        /* Loading skeletons specific to artist page */
        .skeleton-artist-header {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 30px;
        }

        .skeleton-cover-large {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: #e0e0e0;
            animation: skeleton-loading 1s linear infinite alternate;
        }

        @keyframes skeleton-loading {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Simple header -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="hamburger" onclick="window.location.href='/'">â˜°</div>
            <div class="site-title"><a href="/">ZEDTOPVIBES</a></div>
            <div class="right-spacer"></div>
        </div>
    </nav>

    <!-- MAIN CONTENT CONTAINER -->
    <div class="main-content-container" id="content">
        <!-- LEFT SIDEBAR - ARTIST CONTENT -->
        <aside class="left-sidebar">
            <!-- Breadcrumbs skeleton (will be replaced) -->
            <div class="breadcrumbs-left">
                <div class="breadcrumb-nav">
                    <div class="breadcrumb-list">
                        <span class="skeleton" style="width: 60px; height: 20px; display: inline-block;"></span>
                        <span>â€º</span>
                        <span class="skeleton" style="width: 80px; height: 20px; display: inline-block;"></span>
                        <span>â€º</span>
                        <span class="skeleton" style="width: 100px; height: 20px; display: inline-block;"></span>
                    </div>
                </div>
            </div>
            
            <!-- Artist header skeleton -->
            <div class="skeleton-artist-header">
                <div class="skeleton-cover-large"></div>
                <div class="artist-info-large">
                    <div class="skeleton" style="width: 60%; height: 40px; margin-bottom: 15px;"></div>
                    <div class="skeleton" style="width: 40%; height: 24px; margin-bottom: 20px;"></div>
                    <div class="artist-meta-large">
                        <div class="skeleton" style="width: 100px; height: 36px; border-radius: 30px;"></div>
                        <div class="skeleton" style="width: 120px; height: 36px; border-radius: 30px;"></div>
                        <div class="skeleton" style="width: 110px; height: 36px; border-radius: 30px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Songs section header -->
            <div class="section-header">
                <h2 class="section-title">Songs</h2>
                <a href="#" class="view-all">View All âž”</a>
            </div>
            
            <!-- Track skeletons -->
            <div class="track-list" id="tracksList">
                <div class="skeleton-track">
                    <div class="skeleton" style="width: 40px; height: 20px;"></div>
                    <div class="skeleton-track-info" style="flex:1; margin-left:15px;">
                        <div class="skeleton" style="width: 60%; height: 18px; margin-bottom: 6px;"></div>
                        <div class="skeleton" style="width: 30%; height: 14px;"></div>
                    </div>
                </div>
                <div class="skeleton-track">
                    <div class="skeleton" style="width: 40px; height: 20px;"></div>
                    <div class="skeleton-track-info" style="flex:1; margin-left:15px;">
                        <div class="skeleton" style="width: 50%; height: 18px; margin-bottom: 6px;"></div>
                        <div class="skeleton" style="width: 25%; height: 14px;"></div>
                    </div>
                </div>
                <div class="skeleton-track">
                    <div class="skeleton" style="width: 40px; height: 20px;"></div>
                    <div class="skeleton-track-info" style="flex:1; margin-left:15px;">
                        <div class="skeleton" style="width: 55%; height: 18px; margin-bottom: 6px;"></div>
                        <div class="skeleton" style="width: 35%; height: 14px;"></div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- RIGHT SIDEBAR -->
        <div class="right-sidebar">
            <!-- Albums by Artist -->
            <section class="section-block">
                <div class="section-header">
                    <h2 class="section-title">Albums</h2>
                    <a href="#" class="view-all">View All âž”</a>
                </div>
                <div id="albumsList" class="latest-albums-list">
                    <div class="skeleton" style="height: 70px; margin: 10px;"></div>
                    <div class="skeleton" style="height: 70px; margin: 10px;"></div>
                </div>
            </section>
            
            <!-- Similar Artists -->
            <section class="section-block">
                <div class="section-header">
                    <h2 class="section-title">Similar Artists</h2>
                    <a href="#" class="view-all">View All âž”</a>
                </div>
                <div id="similarArtists" class="latest-albums-list">
                    <div class="skeleton" style="height: 70px; margin: 10px;"></div>
                    <div class="skeleton" style="height: 70px; margin: 10px;"></div>
                </div>
            </section>
            
            <!-- Artist Info -->
            <section class="section-block">
                <div class="section-header">
                    <h2 class="section-title">Info</h2>
                </div>
                <div id="artistInfo" style="padding: 15px;">
                    <div class="skeleton" style="width: 100%; height: 16px; margin-bottom: 10px;"></div>
                    <div class="skeleton" style="width: 90%; height: 16px; margin-bottom: 10px;"></div>
                    <div class="skeleton" style="width: 80%; height: 16px;"></div>
                </div>
            </section>
        </div>
    </div>

    <!-- Simple footer -->
    <footer class="footer">
        <div class="footer-links">
            <a href="/">Home</a>
            <a href="/albums.html">Albums</a>
            <a href="/playlists.html">Playlists</a>
            <a href="/artists.html">Artists</a>
        </div>
        <div class="copyright">Â© 2024 Zedtopvibes</div>
    </footer>

    <script type="module">
        // Try to import shared helpers, with fallback
        let formatNumber = (num) => num;
        let formatDuration = (seconds) => {
            if (!seconds) return '?:??';
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        };
        
        try {
            const helpers = await import('/js/shared/helpers.js');
            formatNumber = helpers.formatNumber;
            formatDuration = helpers.formatDuration;
        } catch (e) {
            console.log('Using fallback formatters');
        }

        // API Base
        const API_BASE = '/api';
        
        // Get artist identifier from URL
        const urlParams = new URLSearchParams(window.location.search);
        const artistName = urlParams.get('name');
        
        // Check for slug in path (for clean URLs)
        const pathParts = window.location.pathname.split('/');
        const artistSlug = pathParts[pathParts.length - 1] !== 'artist.html' ? pathParts[pathParts.length - 1] : null;

        // Navigation functions
        window.goHome = () => window.location.href = '/';
        window.goToArtist = (name) => {
            const slug = name.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]/g, '');
            window.location.href = `/artist/${slug}`;
        };
        window.goToSong = (id, slug) => {
            if (slug) window.location.href = `/song/${slug}`;
            else window.location.href = `/song.html?id=${id}`;
        };
        window.goToAlbum = (slug) => window.location.href = `/album/${slug}`;

        // Get emoji for genre (fallback)
        function getEmojiForGenre(genre) {
            const emojis = {
                'electronic': 'ðŸŽµ',
                'synthwave': 'ðŸŽ¸',
                'hiphop': 'ðŸŽ¤',
                'lofi': 'ðŸŒ…',
                'ambient': 'âœ¨',
                'default': 'ðŸŽµ'
            };
            return emojis[genre?.toLowerCase()] || emojis.default;
        }

        // Get artist initials
        function getArtistInitials(name) {
            return name ? name.charAt(0).toUpperCase() : 'ðŸŽµ';
        }

        // Load artist data
        async function loadArtistData() {
            const identifier = artistSlug || artistName;
            
            if (!identifier) {
                document.getElementById('content').innerHTML = '<div style="text-align: center; padding: 60px;">No artist specified</div>';
                return;
            }

            try {
                let artistData;
                
                if (artistSlug) {
                    // Fetch by slug
                    const response = await fetch(`${API_BASE}/artist/${artistSlug}`);
                    if (!response.ok) throw new Error('Artist not found');
                    artistData = await response.json();
                } else {
                    // Fetch all tracks and filter by name (backward compatibility)
                    const response = await fetch(`${API_BASE}/tracks`);
                    const allTracks = await response.json();
                    
                    const artistTracks = allTracks.filter(t => 
                        t.artist.toLowerCase() === decodeURIComponent(artistName).toLowerCase()
                    );
                    
                    if (artistTracks.length === 0) throw new Error('Artist not found');
                    
                    // Calculate stats
                    const totalPlays = artistTracks.reduce((sum, t) => sum + (t.plays || 0), 0);
                    const totalDownloads = artistTracks.reduce((sum, t) => sum + (t.downloads || 0), 0);
                    const totalViews = artistTracks.reduce((sum, t) => sum + (t.views || 0), 0);
                    const genres = [...new Set(artistTracks.map(t => t.genre))];
                    
                    artistData = {
                        name: artistTracks[0].artist,
                        tracks: artistTracks,
                        stats: {
                            track_count: artistTracks.length,
                            total_plays: totalPlays,
                            total_downloads: totalDownloads,
                            total_views: totalViews,
                            genres: genres
                        }
                    };
                }
                
                renderArtistPage(artistData);

            } catch (error) {
                console.error('Error loading artist:', error);
                document.getElementById('content').innerHTML = `
                    <div style="text-align: center; padding: 60px;">
                        <p style="color: #ff5500;">Error: ${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #ff5500; color: white; border: none; border-radius: 20px; cursor: pointer;">Try Again</button>
                    </div>
                `;
            }
        }

        // Render artist page
        function renderArtistPage(data) {
            const artistName = data.name;
            const tracks = data.tracks || [];
            const stats = data.stats || {};
            
            const genres = stats.genres || [...new Set(tracks.map(t => t.genre))];
            const years = tracks.map(t => new Date(t.uploaded_at).getFullYear());
            const earliestYear = Math.min(...years);
            const latestYear = Math.max(...years);

            const content = document.getElementById('content');
            
            content.innerHTML = `
                <!-- LEFT SIDEBAR -->
                <aside class="left-sidebar">
                    <!-- Breadcrumbs -->
                    <div class="breadcrumbs-left">
                        <div class="breadcrumb-nav">
                            <div class="breadcrumb-list">
                                <span class="breadcrumb-link" onclick="window.location.href='/'">Home</span>
                                <span>â€º</span>
                                <span class="breadcrumb-link" onclick="window.location.href='/artists.html'">Artists</span>
                                <span>â€º</span>
                                <span class="breadcrumb-current">${artistName}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Artist Header -->
                    <div class="artist-header">
                        <div class="artist-cover-large">${getArtistInitials(artistName)}</div>
                        <div class="artist-info-large">
                            <h1 class="artist-title-large">${artistName}</h1>
                            <div class="artist-genre-large">${genres.join(' â€¢ ')}</div>
                            <div class="artist-meta-large">
                                <span class="artist-stat-large"><i class="fas fa-music"></i> <strong>${tracks.length}</strong> Songs</span>
                                <span class="artist-stat-large"><i class="fas fa-calendar"></i> <strong>${earliestYear} - ${latestYear}</strong></span>
                                <span class="artist-stat-large"><i class="fas fa-headphones"></i> <strong>${formatNumber(stats.total_plays)}</strong> Plays</span>
                                <span class="artist-stat-large"><i class="fas fa-download"></i> <strong>${formatNumber(stats.total_downloads)}</strong> Downloads</span>
                                <span class="artist-stat-large"><i class="fas fa-eye"></i> <strong>${formatNumber(stats.total_views)}</strong> Views</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Songs Section -->
                    <div class="section-header">
                        <h2 class="section-title">Songs by ${artistName}</h2>
                        <a href="#" class="view-all">View All âž”</a>
                    </div>
                    
                    <div class="track-list">
                        ${tracks.slice(0, 10).map((track, index) => `
                            <div class="track-item" onclick="goToSong(${track.id}, '${track.slug || ''}')">
                                <div class="track-number">${String(index + 1).padStart(2, '0')}</div>
                                <div class="track-info">
                                    <div class="track-title">${track.title}</div>
                                    <div class="track-artist" onclick="event.stopPropagation(); goToArtist('${track.artist?.replace(/'/g, "\\'") || ''}')">${track.artist}</div>
                                    <div class="track-stats-small">
                                        <span><i class="fas fa-clock"></i> ${formatDuration(track.duration)}</span>
                                        <span><i class="fas fa-headphones"></i> ${formatNumber(track.plays)}</span>
                                        <span><i class="fas fa-eye"></i> ${formatNumber(track.views)}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${tracks.length > 10 ? `
                        <div class="pagination-container">
                            <div class="pagination">
                                <a href="#" class="pagination-item pagination-prev">Prev</a>
                                <a href="#" class="pagination-item active">1</a>
                                <a href="#" class="pagination-item">2</a>
                                <a href="#" class="pagination-item">3</a>
                                <span>...</span>
                                <a href="#" class="pagination-item pagination-next">Next</a>
                            </div>
                        </div>
                    ` : ''}
                </aside>
                
                <!-- RIGHT SIDEBAR -->
                <div class="right-sidebar">
                    <!-- Albums by Artist -->
                    <section class="section-block">
                        <div class="section-header">
                            <h2 class="section-title">Albums</h2>
                            <a href="#" class="view-all">View All âž”</a>
                        </div>
                        <div id="albumsList" class="latest-albums-list">
                            <div class="loading">Loading albums...</div>
                        </div>
                    </section>
                    
                    <!-- Similar Artists -->
                    <section class="section-block">
                        <div class="section-header">
                            <h2 class="section-title">Similar Artists</h2>
                            <a href="#" class="view-all">View All âž”</a>
                        </div>
                        <div id="similarArtists" class="latest-albums-list">
                            <div class="loading">Loading...</div>
                        </div>
                    </section>
                    
                    <!-- Artist Info -->
                    <section class="section-block">
                        <div class="section-header">
                            <h2 class="section-title">Info</h2>
                        </div>
                        <div style="padding: 15px;">
                            <p style="color: #666; line-height: 1.6;">
                                ${artistName} has ${tracks.length} tracks available on Zedtopvibes.
                                Their music spans genres including ${genres.join(', ')}.
                            </p>
                        </div>
                    </section>
                </div>
            `;

            // Load albums by this artist
            loadAlbumsByArtist(artistName);
            
            // Load similar artists
            loadSimilarArtists(genres[0], artistName);
        }

        // Load albums by artist
        async function loadAlbumsByArtist(artist) {
            try {
                const response = await fetch(`${API_BASE}/albums`);
                const albums = await response.json();
                
                const artistAlbums = albums.filter(a => a.artist === artist).slice(0, 3);
                
                const container = document.getElementById('albumsList');
                if (container) {
                    if (artistAlbums.length > 0) {
                        container.innerHTML = artistAlbums.map(album => `
                            <div class="sidebar-item" onclick="goToAlbum('${album.slug}')">
                                <div class="sidebar-thumb">${album.cover_emoji || 'ðŸ’¿'}</div>
                                <div class="sidebar-info">
                                    <div class="sidebar-title">${album.title}</div>
                                    <div class="sidebar-sub">${album.track_count || 0} tracks</div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<div style="padding: 15px; text-align: center;">No albums found</div>';
                    }
                }
            } catch (error) {
                console.error('Error loading albums:', error);
            }
        }

        // Load similar artists
        async function loadSimilarArtists(genre, currentArtist) {
            try {
                const response = await fetch(`${API_BASE}/tracks`);
                const allTracks = await response.json();
                
                const similarArtists = [...new Set(
                    allTracks
                        .filter(t => t.genre === genre && t.artist !== currentArtist)
                        .map(t => t.artist)
                )].slice(0, 3);
                
                const container = document.getElementById('similarArtists');
                if (container) {
                    if (similarArtists.length > 0) {
                        container.innerHTML = similarArtists.map(artist => `
                            <div class="sidebar-item" onclick="goToArtist('${artist.replace(/'/g, "\\'")}')">
                                <div class="sidebar-thumb">ðŸ‘¤</div>
                                <div class="sidebar-info">
                                    <div class="sidebar-title">${artist}</div>
                                    <div class="sidebar-sub">${genre}</div>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        container.innerHTML = '<div style="padding: 15px; text-align: center;">No similar artists</div>';
                    }
                }
            } catch (error) {
                console.error('Error loading similar artists:', error);
            }
        }

        // Load artist data
        loadArtistData();
    </script>
</body>
</html>